\RequirePackage{ifluatex}
\documentclass[ngerman,a4paper]{report}
%\usepackage[top=2cm,bottom=2cm,left=1cm,right=1cm]{geometry}
\usepackage[ngerman]{babel}
%\usepackage[utf8]{inputenc} %not recommended with lualatex

\usepackage{etoolbox}
\usepackage{xparse}%better macros
\usepackage{chngcntr}

\usepackage[T1]{fontenc}
\ifluatex
\usepackage{fontspec}
\fi

\usepackage[texindy]{imakeidx}
\makeindex[name=semester1,title={Symbolverzeichnis (1. Semester)}]
\makeindex[name=semester2,title={Symbolverzeichnis (2. Semester)}]
\makeindex[name=symbols,title=Symbolverzeichnis]

\usepackage[xindy,acronym]{glossaries}
\makeglossaries

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{latexsym}
\usepackage{marvosym} %lighning
\usepackage{bbm} %unitary matrix 1
\usepackage{cancel}
\usepackage{xfrac}%sfrac -> fractions e.g. 3/4

\usepackage[table]{xcolor}
\usepackage{graphicx}

\usepackage{enumerate}
\usepackage{enumitem} %customize label

\usepackage{tabularx}
\usepackage{multirow}
\usepackage{booktabs}

\usepackage{ulem} %better underlines

\usepackage{parskip}%split paragraphs by vspace instead of intendations
\usepackage{tocloft}
\usepackage{fancyhdr}
\usepackage{cleveref}
\usepackage{titlesec}%customize titles

\usepackage[amsthm,thmmarks,hyperref]{ntheorem}%customize theorem-environments more effectively
\usepackage[ntheorem,framemethod=TikZ]{mdframed}

\usepackage[bookmarks=true]{hyperref}
\hypersetup{
	colorlinks,
	citecolor=green,
	filecolor=green,
	linkcolor=blue,
	urlcolor=green
}
\usepackage{bookmark}

\definecolor{lightgrey}{gray}{0.91}
\definecolor{lightred}{rgb}{1,0.6,0.6}
\definecolor{darkgrey}{gray}{0.6}
\definecolor{darkgreen}{rgb}{0,0.6,0}

\newlength{\blacktrianglewidth}
\settowidth{\blacktrianglewidth}{$\blacktriangleright$}

%numbered theorems
\theoremstyle{break}
\theorembodyfont{}

\mdfdefinestyle{boxedtheorem}{%
	outerlinewidth=3pt,%
	innertopmargin=\topskip,%
	innerbottommargin=\topskip,%
	skipabove=5pt,%
	skipbelow=10pt,%
	frametitlefont=\normalfont\bfseries\color{black},%
}

\newmdtheoremenv[%
	style=boxedtheorem,%
	linecolor=darkgrey,%
	backgroundcolor=lightgrey,%
]{truetheorem}{Theorem}[section]
\newmdtheoremenv[%
	style=boxedtheorem,%
	linecolor=darkgrey,%
	topline=false,%
	rightline=false,%
	bottomline=false,%
	backgroundcolor=lightgrey,%
]{trueproposition}[truetheorem]{Satz}
\newmdtheoremenv[%
	style=boxedtheorem,%
	linecolor=darkgrey,%
	topline=false,%
	rightline=false,%
	bottomline=false,%
	backgroundcolor=lightgrey,%
]{truelemma}[truetheorem]{Lemma}
\newmdtheoremenv[%
	style=boxedtheorem,%
	linecolor=red,%
	topline=false,%
	rightline=false,%
	bottomline=false,%
]{truedefinition}[truetheorem]{Definition}
\newmdtheoremenv[%
	outerlinewidth=3pt,%
	linecolor=black,%
	topline=false,%
	rightline=false,%
	bottomline=false,%
	innertopmargin=0pt,%
	innerbottommargin=-3pt,%
	frametitlefont=\normalfont\bfseries\color{black},%
	skipabove=5pt,%
	skipbelow=10pt,%
]{trueconclusion}[truetheorem]{Folgerung}
\newmdtheoremenv[%
	hidealllines=true,%
	frametitlefont=\normalfont\bfseries\color{black},%
	innerleftmargin=0pt,%
	skipabove=5pt,%
	innerleftmargin=10pt,%
]{trueremark}[truetheorem]{\hspace*{-10pt}$\blacktriangleright$\hspace*{\dimexpr 10pt - \blacktrianglewidth\relax}Bemerkung}
\newmdtheoremenv[%
	hidealllines=true,%
	frametitlefont=\normalfont\bfseries\color{black},%
	innerleftmargin=10pt,%
]{trueexample}[truetheorem]{\hspace*{-10pt}\rule{5pt}{5pt}\hspace*{5pt}Beispiel}

%unnumbered theorems
\theoremstyle{nonumberbreak}
\theoremindent0cm
\newmdtheoremenv[%
	hidealllines=true,%
	innerleftmargin=10pt,%
]{*trueexample}{\hspace*{-10pt}\rule{5pt}{5pt}\hspace*{5pt}Beispiel}


\NewDocumentCommand{\begriff}{s O{} m O{}}{%
	\IfBooleanTF{#1}%
	{\index{#2#3#4}}%
	{%
		\uline{#3}%
		\ifnumcomp{\value{chapter}}{<}{16}%
			{\index[semester1]{#2#3#4}}%
			{\index[semester2]{#2#3#4}}%
	}%
}
\NewDocumentCommand{\mathsymbol}{s O{} m m O{}}{%
	\IfBooleanTF{#1}%
	{\index[symbols]{#2#3@\detokenize{#4}#5}}%
	{#4\index[symbols]{#2#3@\detokenize{#4}#5}}%
}

\newcommand{\person}[1]{\textsc{#1}}
\newcommand{\highlight}[1]{\emph{#1}}

\newcommand{\realz}{\mathfrak{Re}}
\newcommand{\imagz}{\mathfrak{Im}}

\renewcommand{\epsilon}{\varepsilon}

%change headings:
\titlelabel{\thetitle.\quad}%. behind section/sub... (3. instead of 3)
\counterwithout{section}{chapter}
\renewcommand{\thechapter}{\Roman{chapter}}
%italic chapters (due to titlesec package some more stuff)
\titleformat{\chapter}[display]{\huge\bfseries\itshape}{\chaptername\;\thechapter}{5pt}{\huge\bfseries}
\titlespacing{\chapter}{0pt}{0pt}{10pt}
\titleformat{\section}[hang]{\bfseries\Large}{\thesection.}{9pt}{\Large\bfseries}

%change header:
\renewcommand{\headrulewidth}{0.75pt}
\renewcommand{\footrulewidth}{0.3pt}
\lhead{\rightmark}%left: section-number. section-title
\rhead{\leftmark}%right: chapter chapternumber: chapter-title

%change appearence of heading of toc: 0 space above, bold, italic huge toc-heading
\renewcommand{\cftbeforetoctitleskip}{0pt}
\renewcommand{\cfttoctitlefont}{\itshape\Huge\bfseries}

%change numbering of equations to be section by section
\counterwithout{equation}{section}

\author{Dozent: Prof. F Schuricht}
\title{Analysis Grundlagen 1 \& 2} % add WS & SS
\date{Updated: \today}

\pagenumbering{roman}
\begin{document}

\maketitle
\tableofcontents

\pagebreak
\pagestyle{fancy}
\pagenumbering{arabic}
%remember chapter-title in \leftmark and \rightmark
\renewcommand{\chaptermark}[1]{%
	\markboth{\chaptername
		\ \thechapter:\ #1}{}}
%remember section title in \leftmark
\renewcommand{\sectionmark}[1]{%
	\markright{\thesection.\ #1}{}}

\chapter{Funktionen und Stetigkeit}

\section{Anwendungen}

\begin{truetheorem}[Mit Titel]
    test
\end{truetheorem}

\begin{trueproposition}[Incl. Titel]
    Und Inhalt.
\end{trueproposition}

\subsection{Partialbruchzerlegung}
	
\begin{truetheorem}[Mit Titel]
	test
\end{truetheorem}
	
\begin{trueproposition}[Incl. Titel]
	Und Inhalt.
\end{trueproposition}

\section{Noch mehr Anwendungen}

\begin{truedefinition}[Und Name]
	Tada
\end{truedefinition}

\begin{trueexample}[Einschließlich Überschrift]
	Verständnisfördernd...
\end{trueexample}

\begin{trueconclusion}[Ergänzung]
	Einfache Schlussfolgerung
\end{trueconclusion}

\begin{truelemma}
	nur Müll
\end{truelemma}

\begin{truelemma}[Kurze, aber wichtige, Aussage]
	Klein aber fein.
\end{truelemma}

\begin{trueremark}[Hossa]
	Dumdidum
\end{trueremark}

\begin{trueexample}[Test]
	LOhne Nummer
\end{trueexample}

\begin{proof}
	Ein Beweis.
	
	\begin{align}
		f = f(x) \text{ (mit Formelnnummer)}
	\end{align}
	und inline-math $\hbar$.
\end{proof}

\chapter{Its you}

\section{Or me?}

\begin{truetheorem}[Mit Titel]
    test
\end{truetheorem}

\begin{trueproposition}[Incl. Titel]
    Und Inhalt.
\end{trueproposition}

\begin{truedefinition}[Und Name]
    Tada
\end{truedefinition}

\begin{trueexample}[Einschließlich Überschrift]
    Verständnisfördernd...
\end{trueexample}

\begin{trueconclusion}[Ergänzung]
    Einfache Schlussfolgerung
\end{trueconclusion}

\begin{truelemma}[Kurze Aussage]
    Klein aber fein.
\end{truelemma}

\begin{trueremark}[Hossa]
    Dumdidum
\end{trueremark}

\begin{*trueexample}[Test]
    Ohne Nummer
\end{*trueexample}

\begin{proof}
    Ein Beweis.
    
    \begin{align}
    f = f(x) \text{ (mit Formelnnummer)}
    \end{align}
    und inline-math $\hbar$.
\end{proof}

\theoremlisttype{allname}
\listtheorems{truetheorem}

\end{document}